eccube-on-bootstrap3-custom
====================
TwitterBootstrapを使った[EC-CUBE](http://www.ec-cube.net)用のデザインテンプレートで、

傑作と名高い [clicktx/eccube-on-bootstrap3](https://github.com/clicktx/eccube-on-bootstrap3) の私的カスタマイズフォーク。

### 開発環境
- EC-CUBE 2.13.5 and 2.17
- [Twitter Bootstrap Honoka 3.3.7](https://github.com/windyakin/Honoka)


## まずは本家readmeを見てくれ

[clicktx/eccube-on-bootstrap3](https://github.com/clicktx/eccube-on-bootstrap3)

特にスマートフォン用テンプレートを無効化するあたり確認が必要。

## カスタムのコンセプト

1. Bootstrap は、日本語表示を改善させたカスタマイズテーマ Honoka 3.3.7 を利用する
2. 可能な限り内部ライブラリを減らし、転送量を下げ、非同期ロードする
3. お客様がわかりやすい・理解しやすい・ヘイトを溜めないECサイトとしての表現に直す

### こんな方にお勧めします

- 運用サーバの速度が遅い
- 運用サーバが従量制・転送量制課金である
- [Honoka](https://honokak.osaka/)の日本語処理・丸みを抑えたデザインが好きだ

## 本家にはないカスタマイズのキモ

### CSS/JSのカスタマイズ

css容量削減と読込最適化のため、scss/sassにて管理しています。
当方ではnode-sassを使用し、コマンド例を/_packages/scss/m.scss に記述してあります。これを編集してコンパイルしてください。

bootstrapが外部CDNからの読み込みのため、元テンプレートで可能だった全文grep置換で色を変える、みたいなことは不可能です。cssセレクタによる上書きを検討してください。

また転送量削減・高速化の為に以下の工夫を。
- 可能な限りCDNを利用する。jQueryは高速CDNとして名高いmicrosoftなど。万が一の為にローカルにフォールバックも用意。
- 不要なjsを省く。vimキーバインドなど
- 深刻な影響が出ない程度に、読込位置を配置変更
- 深刻な影響が出ない程度に、CSS/JSをノンブロッキングロードする


### .htaccessのカスタマイズ

このプログラムのルートにある「test.htaccess」をEC-CUBEの「/html/」の中に入れ、「.htaccess」にリネームすることで、更に2つの機能が利用できます。htaccessファイルはサーバが対応していないこともありますので、サーバ担当にお問合せください。

#### htaccessで転送量の低減・高速化

データの圧縮転送やキャッシュ利用による転送量の低減ができます。これにより高速化が期待できます。keep-alive有効・ETag無効などもあるよ。

#### EC-CUBEのシステム外で発生した404エラーページも、EC-CUBE上で行えるようにリダイレクト

EC-CUBEを導入した多くのサイトでは、2つの404エラーが発生します。「EC-CUBE内部で発生した404エラー」（product_idが違う、商品が削除・非表示になったなど）は、ec-cubeのerror.phpが呼び出されますが、「EC-CUBE外部で発生した404エラー」（~/user_dadada/ などのミスタイプURLで行き着く先）は、サーバソフト自体からの404エラーが帰ってきます（セキュリティに乏しいWebサーバはサーバソフトのバージョンが漏れたりなんてすることも）。

そこで後者「EC-CUBE外部で発生した404エラー」をproduct_idが「not_found_404」の商品詳細ページに飛ばしてエラーを出し、無理やり「EC-CUBE内部で発生した404エラー」にしてしまうというエクストリーム実装をしております。気持ち悪い実装ですが、回避するにはec-cube本体のエラー処理に手を付けてください。


### 404ページのカスタマイズ

404ページにまつわるSEO効果向上・離脱率低減対策もほどこしています。

「EC-CUBE内部で発生した404エラー」、つまり「ページが見つかりません」とだけ出力されたエラーページが出る場合、お客様がこのページを閲覧する時は、大体のケースでは商品を探している
場合が多い為、検索窓と、より見つけやすくなるための検索tipsを追記しております。


### 税込表示義務化のカスタマイズ

https://webtan-tsushin.com/next_20181017_tax

2021/04/01以降は商品に対する消費税の総額表示（税込）が必要になるため、税込表示を、商品の表示時、それと注文における合計の表示時に、(税込)記述を付与しました。うざったくなりすぎないように抑えてます。また、「円」「（税込）」それぞれにclass付spanを付与している為、カスタマイズがラクです。


### ECサイトとしての表現のカスタマイズ

この辺は各ECサイトや運営企業の色が出る箇所ですので、色々こねくりまわしてみてください。自身の運営経験による勘所を信じて、以下の変更を施しました。

- ヘッダの部分の「アカウントサービス」とあったパーツを、「MYページへログイン」ボタンにしました。ログインページまでのクリック数削減と、「「MYページ」と同義と判断して統一化が目的。
- 割と長めの警告の場合、敬語をカスタマイズして短縮化しています（長いと読まんのよ）。
- 「パスワードを忘れた」は、お客様自身の瑕疵だと認識することがありヘイトを溜めやすいため、「パスワードがわからない」と替え、外的要因からわからないこともあるんやでという話を行間に込めました。
- 「コンピューターに記憶する」は、そもそもスマホをコンピューターだと認識していない層に納得させるため、その辺いい感じに替えました。
- その他ゆらぎ表現や遷移状の問題など諸々修正。


### トップページのスライドショーカスタマイズ

スライドショーをつけました。実装はbootstrap3標準のカルーセルを使っています。使用箇所はトップページ（index.tpl）のみですが、他に適用する場合はそこを参考にしてください。


### OGP対応のカスタマイズ

ogタグを入れ、ブログカード対応にしました。更にリンクページが商品詳細ページの場合、その商品の１枚目・メイン画像がカード内に表示されるようにしております。


## Google Analytics 拡張eコマース 中途半端に対応
最新式のGAスクリプト、gtag.jsを導入し、拡張eコマース機能に対応しました（phpのカスタマイズほぼなし）。設定は site_frame.tplの上段にconfig用変数を用意しています。そこにUAから始まるIDを入れるだけで対応可能です。

注文確認画面（注文完了or決済の手前のページ）と注文完了画面にて（個人情報を省いた）ユーザの購入物品・購入金額を追跡できるようにしております。注文完了画面のところに注文番号を渡して追跡性を上げることも可能ですが、こちらは本体phpのカスタマイズが必要になります。気になる方は/shopping/complete.tplの最後のコメントを読んでね。

また、後述の/frontparts/bloc/#af_get_utm.tpl の内容をブロックとして、流入が発生するページ（トップや商品一覧・商品詳細など）に設置することで、UTMパラメータを拡張eコマースの「キャンペーン」に渡すことが可能です。GA側から「[source]--[medium]--[campaign]」みたいな感じにて取得できます。

中途半端というのは、拡張eコマース機能の全てを実装しきれていない為です。本当はカゴ入れやその後の遷移についても追跡できるようにしたい。

## べんりなブロック素材
/frontparts/bloc/ 内にあるtplのうち、頭に#がついているものは、ブロック素材です。デザイン管理のブロック設定から登録し、中の内容をコピーして適所に貼り付けてみてください。

#af_get_utm.tpl
google analytics 拡張eコマースの「キャンペーン」に、URLクエリについてくるUTMから始まる内容を渡す

#social_button_top.tpl
商品詳細ページなどの右上に、twitter/facebook/lineによる共有ボタンを追加する


## プラグインについて
eccube-on-bootstrap3対応プラグインの検証はしてませんが、基本bootstrapの構造は近いため、使える可能性はあります。


## ライセンスについて
元のテンプレートにGPLの記載があった為、GPLv2とします。